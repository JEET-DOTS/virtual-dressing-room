function ChatContainer(e, t) { function a(e) { setTimeout(function () { v = $('<div class="chat-trigger"><svg class="open" width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4.583 14.894l-3.256 3.78c-.7.813-1.26.598-1.25-.46a10689.413 10689.413 0 0 1 .035-4.775V4.816a3.89 3.89 0 0 1 3.88-3.89h12.064a3.885 3.885 0 0 1 3.882 3.89v6.185a3.89 3.89 0 0 1-3.882 3.89H4.583z" fill="#FFF" fill-rule="evenodd"></path></svg><svg class="close"  width="17" height="17" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg"><path d="M16.726 15.402c.365.366.365.96 0 1.324-.178.178-.416.274-.663.274-.246 0-.484-.096-.663-.274L8.323 9.648h.353L1.6 16.726c-.177.178-.416.274-.663.274-.246 0-.484-.096-.663-.274-.365-.365-.365-.958 0-1.324L7.35 8.324v.35L.275 1.6C-.09 1.233-.09.64.274.274c.367-.365.96-.365 1.326 0l7.076 7.078h-.353L15.4.274c.366-.365.96-.365 1.326 0 .365.366.365.958 0 1.324L9.65 8.675v-.35l7.076 7.077z" fill="#FFF" fill-rule="evenodd"></path></svg></div>'), $("body").append(v), v.click(s), "function" == typeof e && e() }, L) } function n() { var e = $("#chat-welcome").html(); f = $(e); var t = $("form", f).on("submit", function () { return p.push(a.val()), a.val(""), f.removeClass("visible"), v.removeClass("opened"), w || o(), i(), !1 }), a = $("textarea", f).on("input", function () { var e = this.scrollHeight; if (e > 130) return !0; this.style.height = e + "px" }); $("textarea", f).on("keypress", function () { event.ctrlKey || 13 !== event.keyCode || t.submit() }), $(".submit", f).on("click", function () { t.submit() }), $("body").append(f) } function o() { w = $('<div class="chat-iframe"><div class="loading_iframe"></div></div>'), $("body").append(w), window.hideLoader = function () { $(".loading_iframe", ".chat-iframe").addClass("hide"); try { g.get(0).contentWindow.focus() } catch (e) { } }, g = $('<iframe onload="hideLoader()" src="' + window.region_url + 'chat/client/"></iframe>'), $(".chat-iframe").append(g), h = !1 } function i() { w.addClass("visible"), $(window).trigger("chatOpen"), h = !0, c({ eventAction: "chatbot_open" }); try { g.get(0).contentWindow.focus() } catch (e) { } } function r() { w.removeClass("visible"), h = !1, $(window).trigger("chatClose"), c({ eventAction: "chatbot_closed" }) } function s() { if (!u) return !1; if (!m || h) { var e = localStorage.getItem("conversationID"); if (null == _ && null != e && (_ = e), _) w ? h ? r() : i() : (o(), setTimeout(function () { h ? r() : i() }, 100)); else { var t = $(this); t.hasClass("opened") ? (f.removeClass("visible"), t.removeClass("opened")) : (f.addClass("visible"), t.addClass("opened"), $("textarea", f).focus()) } return !1 } m.trigger("click") } function c(e) { "undefined" != typeof dataLayer && dataLayer.push($.extend(e, { event: "analyticsEvent", eventCategory: "chatbot" })) } function l(e, t) { var a = localStorage.getItem("invitation_close"), n = localStorage.getItem("open_invitation"); if (a) { var o = (new Date).getTime() - a; if (Math.round(o % 864e5 % 36e5 / 6e4) < 5) return; localStorage.removeItem("invitation_close") } if (n) { var i = (new Date).getTime() - n; if (Math.round(i % 864e5 % 36e5 / 6e4) < 15) return; localStorage.removeItem("open_invitation") } $("body").append(e), c({ eventAction: "chatbot_trigger", eventLabel: t.name }), m = $(".chat_invitation"), C = t, m.fadeIn() } function d(e) { var t = null; y = null; for (var a in e) { var n = e[a]; switch (n.trigger_regex) { case "contains": case "end_with": default: switch (n.trigger) { case "url": void 0 !== dataLayer[0].url && !1 !== dataLayer[0].url.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n); break; case "contentGroup1": void 0 !== dataLayer[0].contentGroup1 && !1 !== dataLayer[0].contentGroup1.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n); break; case "contentGroup2": void 0 !== dataLayer[0].contentGroup2 && !1 !== dataLayer[0].contentGroup2.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n) }break; case "starts_with": switch (n.trigger) { case "url": void 0 !== dataLayer[0].url && 0 === dataLayer[0].url.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n); break; case "contentGroup1": void 0 !== dataLayer[0].contentGroup1 && 0 === dataLayer[0].contentGroup1.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n); break; case "contentGroup2": void 0 !== dataLayer[0].contentGroup2 && 0 === dataLayer[0].contentGroup2.toLowerCase().indexOf(n.trigger_value.toLowerCase()) && (t = n) }break; case "regex": switch (n.trigger) { case "url": void 0 !== dataLayer[0].url && null !== dataLayer[0].url.toLowerCase().match(n.trigger_value) && (t = n); break; case "contentGroup1": void 0 !== dataLayer[0].contentGroup1 && null !== dataLayer[0].contentGroup1.toLowerCase().match(n.trigger_value) && (t = n); break; case "contentGroup2": void 0 !== dataLayer[0].contentGroup2 && null !== dataLayer[0].contentGroup2.toLowerCase().match(n.trigger_value) && (t = n) } }if ("all" !== n.customer_segment && dataLayer[0].customer_segment !== n.customer_segment && (t = null), null != t) break } if (null != t) { var o = dataLayer[0].lang, i = {}; for (var r in t.i18n[o]) { var s = t.i18n[o][r].value.split(/\r?\n/); s = s.join(";"), i[t.i18n[o][r].field] = s } y = i; var c = tmpl("chat_invitation_tmpl", i); if (t.timeout > 0) setTimeout(function () { h || f && f.hasClass("visible") || l(c, t) }, 1e3 * t.timeout); else if (t.scrollY > 0) { var d = !1; $(document).scroll(function () { if (!d && $(this).scrollTop() > t.scrollY) { if (d = !0, h) return; if (f && f.hasClass("visible")) return; l(c, t) } }) } else { if (h) return; l(c, t) } } } var u, v, f, g, h, w, m, p = [], L = 1e3, _ = t, y = null, C = null, b = { conversationID: _, url: window.top.location.href, ua: navigator.userAgent }; void 0 !== window.dataLayer && window.dataLayer.length && (b = $.extend(window.dataLayer[0], b)); var x = getStoredCustomer(); x && (b = $.extend(b, x)), $.getJSON(e.server + "/status", b, function (t) { switch (v || a(function () { d(t.invitations) }), f || n(), u = t, f.addClass(t.status), t.status) { case "offline": $(".chat_welcome_message", f).html(e.i18n.offline); break; default: $(".chat_welcome_message", f).html(t.status.local_lang ? e.i18n.welcome : e.i18n.onlyenglish) }window.location.search.indexOf("chat=open") > -1 && s() }), $(document).on("click", ".chat_invitation", function (e) { if (!$(e.target).hasClass("chat_invitation_close")) { if (f.removeClass("visible"), v.removeClass("opened"), m.remove(), w || o(), i(), !h) for (setTimeout(function () { h = !0 }, 5e3); h;); setTimeout(function () { w.find("iframe").get(0).contentWindow.postMessage({ chat: !0, action: "sendChatInvitation", message: y }, window.location); var e = new Event("open_invitation"); window.dispatchEvent(e) }, 500) } }), $(document).on("click", ".chat_invitation_close", function () { var e = new Event("close_invitation"); window.dispatchEvent(e) }); var k = null; $(document).on("mouseenter", ".chat_invitation", function (e) { var t = $(".chat_invitation_close", m); k && clearTimeout(k), t.fadeIn("show") }), $(document).on("mouseleave", ".chat_invitation", function (e) { var t = $(".chat_invitation_close", m); k = setTimeout(function () { t.fadeOut("show"), k = null }, 1e3) }), window.addEventListener("close_invitation", function (e) { localStorage.setItem("invitation_close", (new Date).getTime()), null != C && c({ eventAction: "chatbot_trigger_close", eventLabel: C.name }), m.fadeOut() }, !1), window.addEventListener("open_invitation", function (e) { localStorage.setItem("open_invitation", (new Date).getTime()), null != C && c({ eventAction: "chatbot_trigger_open", eventLabel: C.name }), m.fadeOut() }, !1), window.addEventListener("message", function (e) { if ("object" == typeof e.data && void 0 !== e.data.chat) switch (e.data.action) { case "close": r(); break; case "online": if (p) for (var t = w.find("iframe").get(0).contentWindow, a = 0; a < p.length; a++)t.postMessage({ chat: !0, action: "sendMessage", message: p[a] }, window.location); break; case "analytics": c(e.data) } }, !1) }